# Arbees Environment Configuration
# Copy this to .env and fill in your values
#
# SECURITY WARNING:
# - NEVER commit .env to git (it's in .gitignore)
# - NEVER use default/example passwords in production
# - Generate secure passwords: openssl rand -base64 32
# - Use secrets management in production (AWS Secrets Manager, etc.)

# =============================================================================
# REQUIRED - Docker Compose will fail without these
# =============================================================================

# PostgreSQL/TimescaleDB credentials (used by docker-compose)
POSTGRES_USER=arbees
POSTGRES_PASSWORD=CHANGE_ME_USE_SECURE_PASSWORD
POSTGRES_DB=arbees

# Full database connection URL (used by Python services)
# Must match POSTGRES_USER/PASSWORD above
DATABASE_URL=postgresql://arbees:CHANGE_ME_USE_SECURE_PASSWORD@localhost:5432/arbees

# =============================================================================
# OPTIONAL - For production/AWS deployment
# =============================================================================

# AWS credentials (for deployment - not needed for local Docker development)
# Create an IAM user with programmatic access at https://console.aws.amazon.com/iam
# AWS_ACCESS_KEY_ID=your_access_key_id
# AWS_SECRET_ACCESS_KEY=your_secret_access_key
# AWS_REGION=us-east-1

# Production database (different from local Docker)
# DB_USER=arbees
# DB_PASSWORD=your_production_password

# =============================================================================
# MARKET API CREDENTIALS
# =============================================================================

# Kalshi API - Get your API key from https://kalshi.com/account/api
# KALSHI_API_KEY=your_kalshi_api_key
# KALSHI_PRIVATE_KEY_PATH=/path/to/your/private_key.pem
# Or provide key as string (escape newlines):
# KALSHI_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"

# Polymarket API (optional)
# POLYMARKET_API_KEY=your_polymarket_api_key

# EU Polymarket Proxy (for regulatory compliance)
# EU_POLYMARKET_PROXY_URL=http://polymarket-proxy.eu-central-1.internal:8080

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================

# Redis
REDIS_URL=redis://localhost:6379

# Logging
LOG_LEVEL=INFO

# Paper Trading
INITIAL_BANKROLL=1000
MIN_EDGE_PCT=2.0
KELLY_FRACTION=0.25
MAX_POSITION_PCT=10.0

# Risk Management
MAX_DAILY_LOSS=100.0         # Stop trading after losing $100 in a day
MAX_GAME_EXPOSURE=50.0       # Maximum $ exposure to any single game
MAX_SPORT_EXPOSURE=200.0     # Maximum $ exposure to any single sport
MAX_LATENCY_MS=5000.0        # Reject signals older than 5 seconds

# Position policy
# If true, allow multiple open positions on the same game as long as they are not identical
# (same platform + market_id + side). This enables hedging.
ALLOW_HEDGING=false

# =============================================================================
# EXIT MONITORING (Active Position Exit)
# =============================================================================
# The Position Manager actively monitors open positions and exits when:
# - Probability moves in our favor by TAKE_PROFIT_PCT (lock in profit)
# - Probability moves against us by STOP_LOSS (cut losses)

TAKE_PROFIT_PCT=3.0          # Exit when prob moves 3%+ in our favor (all sports)
DEFAULT_STOP_LOSS_PCT=5.0    # Fallback stop-loss if sport not configured
EXIT_CHECK_INTERVAL=1.0      # Check positions every 1 second (polling fallback)

# Sport-specific stop-loss thresholds (% probability move against us)
# Higher-scoring sports = tighter stop-loss (more frequent score changes)
# Lower-scoring sports = wider stop-loss (score changes are bigger swings)
STOP_LOSS_NBA=3.0            # Basketball: fast-paced, frequent scoring
STOP_LOSS_NCAAB=3.0          # College basketball: similar to NBA
STOP_LOSS_NFL=5.0            # Football: medium pace, touchdowns = 7pts
STOP_LOSS_NCAAF=5.0          # College football: similar to NFL
STOP_LOSS_NHL=7.0            # Hockey: low scoring, each goal is significant
STOP_LOSS_MLB=6.0            # Baseball: low scoring, but innings can swing
STOP_LOSS_MLS=7.0            # MLS Soccer: low scoring like hockey
STOP_LOSS_SOCCER=7.0         # Soccer: low scoring
STOP_LOSS_TENNIS=4.0         # Tennis: point-by-point volatility
STOP_LOSS_MMA=8.0            # MMA: binary outcome, big swings possible

# GameShard Configuration
SHARD_ID=shard-1
MAX_GAMES_PER_SHARD=20
DEFAULT_POLL_INTERVAL=3.0
CRUNCH_TIME_INTERVAL=1.0

# =============================================================================
# POSITION TRACKER HARDENING
# =============================================================================
# These settings help prevent false exits due to stale or invalid market data

# Maximum age of market price (seconds) before skipping exit evaluation
# Set higher if your market data updates are less frequent
PRICE_STALENESS_TTL=30.0

# If true, skip exit evaluation when bid<=0 and ask>=1 (empty book)
# Also skips when spread > 50% (pathological book)
REQUIRE_VALID_BOOK=true

# Number of consecutive exit triggers required before actually exiting
# Set to 2-3 to add debounce and prevent noisy exits (0=disabled)
DEBOUNCE_EXIT_CHECKS=0

# Minimum time (seconds) to hold a position before evaluating exits
# Prevents immediate stop-loss on entry spread
MIN_HOLD_SECONDS=10.0

# =============================================================================
# DEBUG / TRACE LOGGING
# =============================================================================
# NDJSON trace logs provide end-to-end visibility for debugging trades

# Enable/disable NDJSON trace logging (writes to DEBUG_LOG_PATH)
TRACE_LOGGING_ENABLED=true

# Path for NDJSON debug logs (mounted from host in Docker)
DEBUG_LOG_PATH=/app/.cursor/debug.log
